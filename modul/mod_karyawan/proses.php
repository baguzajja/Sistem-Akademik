<?phpdefined('_FINDEX_') or die('Access Denied');//Tambah dan Edit Modulif(isset($_POST['simpanKaryawan'])) {		$md 			= $_POST['md']+0;		$id		     	= $_POST['id'];		$identitas		= $_POST['identitas'];		if (!empty($_POST[kode_jurusan])){		$jur = $_POST[kode_jurusan];		$tag=implode(',',$jur);		}		$username     	= $_POST['username'];        $password     	= md5($_POST[password]);        $Jbtn   		= $_POST['Jbtn'];           $Level		   	= $_POST['Level'];           $nama_lengkap 	= $_POST['nama_lengkap'];                $Bagian 		= $_POST['bagian'];                $email        	= $_POST['email'];        $telepon      	= $_POST['telepon'];        $aktif    		= $_POST['aktif'];		$id_level		=$_POST['jabatan'];        $CekModul		=$_POST['CekModul'];if ($md == 0) {if (empty($_POST[password])) {//Update Karywan $update=_query("UPDATE karyawan SET 	username 		= '$username',                                          	Jabatan			= '$Jbtn',	Bagian			= '$Bagian',	nama_lengkap	= '$nama_lengkap',	Identitas_ID	= '$identitas',	kode_jurusan	= '$tag',	email			= '$email',	telepon			= '$telepon',	id_level		= '$Level',	aktif			= '$aktif'                       	WHERE id	= '$id'");//Update Useryapan$useryapan=_query("UPDATE useryapan SET 			Nama			= '$nama_lengkap',     			email			= '$email',			Jabatan			= '$Jbtn',			LevelID			= '$Level',			Bagian			= '$Bagian',			username		= '$username',			aktif			= '$aktif'                       			WHERE username	= '$username'");}else{//Update Karywan$update=_query("UPDATE karyawan SET 	username 		= '$username',                                          	Jabatan			= '$Jbtn',	Bagian			= '$Bagian',	nama_lengkap	= '$nama_lengkap',	password    	= '$password',	Identitas_ID	= '$identitas',	kode_jurusan	= '$tag',	email			= '$email',	telepon			= '$telepon',	id_level		= '$Level',	aktif			= '$aktif'                       	WHERE id	= '$id'");//Update Useryapan	$useryapan=_query("UPDATE useryapan SET 			password    	= '$password',			Nama			= '$nama_lengkap',     			email			= '$email',			Jabatan			= '$Jbtn',			kodeProdi		= '$tag',			LevelID			= '$Level',			Bagian			= '$Bagian',			aktif			= '$aktif'                       			WHERE username	= '$username'");    }	if($update AND $useryapan AND isset($_POST['simpanKaryawan'])){					alert('info','Data Staff Berhasil di Update');			CatatLog($_SESSION['Nama'],'Update Data Staff',"Data Staff Berhasil Di Update");			htmlRedirect('go-karyawan.html',2);		}  } else {	$ada = GetFields('karyawan', 'username', $username, '*');	$ada1 = GetFields('useryapan', 'username', $username, '*');    if (empty($ada) && empty($ada1) ) {//masukkan karyawan  $query = "INSERT INTO karyawan(id_level,username,password,Jabatan,Bagian,nama_lengkap,Identitas_ID,kode_jurusan,email,telepon,aktif)VALUES('$Level','$username','$password','$Jbtn','$Bagian','$nama_lengkap','$identitas','$tag','$email','$telepon','$aktif')";    $inKaryawan=_query($query);//masukkan User	 if($inKaryawan){			$InUser =_query("INSERT INTO useryapan(username,password,LevelID,Nama,IdentitasID,kodeProdi,Bagian,Jabatan,email,aktif,Log,SessionID)VALUES	('$username','$password','$Level','$nama_lengkap','$identitas','$tag','$Bagian','$Jbtn','$email','$aktif','','')");		   if($InUser AND isset($_POST['simpanKaryawan'])){					alert('info','Data Staff Berhasil di Simpan');			CatatLog($_SESSION['Nama'],'Tambah Staff baru',"Data Staff Baru Berhasil di Simpan");			htmlRedirect('go-karyawan.html',2);		}	}} else {      	alert("error", "Username : $username Sudah ada dalam database");	CatatLog($_SESSION['Nama'],'Tambah Staff baru',"Gagal menambah Staff..Data Sudah ada dalam database");	}  }	}// Upload Fotoif(isset($_POST['Upload'])) { 		if(empty($_POST['Id'])){		alert('error','User Belum Ada...!! Buat User Terlebih Dahulu');		CatatLog($_SESSION[Nama],'Upload Foto','Gagal Meng-Upload Foto Karena User Belum Ada.');	}else{		$id 			= $_POST['Id'];		$lokasi_file    = $_FILES['foto']['tmp_name'];		$tipe_file      = $_FILES['foto']['type'];		$nama_file      = $_FILES['foto']['name'];		$acak           = rand(1,99);		$nama_file_unik = $acak.$nama_file;		$dest = "media/images/foto_user/";		if (!empty($lokasi_file)){			if ($tipe_file != "image/jpeg" AND $tipe_file != "image/pjpeg"){			alert('info','Upload Gagal, Pastikan File yang di Upload bertipe *.JPG');		}else{			$Upload=UploadPhoto($nama_file_unik,$lokasi_file, $dest);			  if ($Upload){				$fotoc= _query("SELECT * FROM karyawan where id='$id' LIMIT 0,1") or die ();				$rfoto=_fetch_array($fotoc);				if($rfoto[foto]!=''){					unlink("$dest/$rfoto[foto]");      					unlink("$dest/small_$rfoto[foto]");      					unlink("$dest/medium_$rfoto[foto]");      				}				$r = _query("UPDATE karyawan set foto='$nama_file_unik' where id='$id'");				alert('info','Upload Foto Berhasil');				CatatLog($_SESSION[Nama],'Upload Foto','Upload Foto Berhasil');				} else { 				alert("error", "Gagal Upload Foto.. !! Tidak dapat meng-upload file foto.<br />				Periksa file yg di-upload,  karena besar file dibatasi cuma: <b>$_POST[MAX_FILE_SIZE]</b> byte.");				CatatLog($_SESSION[Nama],'Upload Foto','Gagal Meng-Upload Foto Karena File Terlalu besar');				}			}		}	}}// Hapus Staffif(isset($_POST['delete'])){$source = @$_POST['check'];$source = multipleSelect($source);if(empty($source)){alert('error','Pilih Staff yang Akan di Hapus');CatatLog($_SESSION[Nama],'Hapus Data Staff','Gagal Meng-Hapus Id Belum Dipilih');}else{$del = explode(",",$source);foreach($del as $id){	$cek=_fetch_array(_query("SELECT * FROM karyawan WHERE id='$id'"));	if ($cek['foto']!=''){		$tabel="karyawan";		$kondisi="id='$id'";		$delete = delete($tabel,$kondisi);		$tabel1="useryapan";		$kondisi1="username='$cek[username]'";		$delete1=delete($tabel1,$kondisi1);				unlink("$cek[foto]");	}else{		$tabel="karyawan";		$kondisi="id='$id'";		$delete = delete($tabel,$kondisi);		$tabel1="useryapan";		$kondisi1="username='$cek[username]'";		$delete1=delete($tabel1,$kondisi1);	}	}alert('info','Data Staff Berhasil di Hapus');CatatLog($_SESSION[Nama],'Hapus Data Staff','Data Staff Berhasil di Hapus');}}