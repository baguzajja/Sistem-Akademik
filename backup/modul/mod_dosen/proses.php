<?phpdefined('_FINDEX_') or die('Access Denied');//Tambah Dosenif(isset($_POST['simpanDosen'])) {	$TanggalLahir=sprintf("%02d%02d%02d",$_POST[thnlahir],$_POST[blnlahir],$_POST[tgllahir]);	if (!empty($_POST[Jurusan_ID])){	$jur = $_POST[Jurusan_ID];	$tag=implode(',',$jur);	}	$status=(empty($_POST['NIDN']))? 'N':'Y';		$cek=_num_rows(_query("SELECT * FROM dosen WHERE NIDN='$_POST[NIDN]'"));        if ($cek > 0){		alert('error','Opps.. !! Data NIDN Sudah ada dalam database.');		CatatLog($_SESSION['Nama'],'Tambah Dosen','Gagal Tambah Dosen ..Data NIDN Sudah ada dalam database.');        } else {		$pass=md5($_POST[password]);		$insert=_query("INSERT INTO dosen(username,password,NIDN,nama_lengkap,TempatLahir,TanggalLahir,Agama,Email,Telepon,Handphone,Identitas_ID,Jurusan_ID,Jabatan_ID,Gelar,Aktif)          VALUES('$_POST[NIDN]','$pass',          '$_POST[NIDN]',          '$_POST[nama_lengkap]',          '$_POST[TempatLahir]',          '$TanggalLahir',          '$_POST[Agama]',                 '$_POST[Email]',          '$_POST[Telepon]',          '$_POST[Handphone]',          '$_POST[identitas]',          '$tag',          '$_POST[Jbtn]',          '$_POST[Gelar]',          '$_POST[Aktif]')");  	$UserYapan ="INSERT INTO useryapan(username,password,LevelID,Nama,IdentitasID,kodeProdi,Bagian,Jabatan,email,aktif,Log,SessionID)VALUES	('$_POST[NIDN]','$pass','2','$_POST[nama_lengkap]','$_POST[identitas]','$tag','dosen','$_POST[Jbtn]','$_POST[Email]','$status','','')";	$InsertUserYapan=_query($UserYapan);			if($InsertUserYapan AND $insert){			alert('info','Dosen Berhasil Disimpan');			CatatLog($_SESSION['Nama'],'Tambah Dosen','Dosen Berhasil Disimpan');			htmlRedirect('go-dosen.html',2);		}	}}// Update Dosenif(isset($_POST['UpdateDosen'])) { 	  	$TanggalLahir=sprintf("%02d%02d%02d",$_POST[thnlahir],$_POST[blnlahir],$_POST[tgllahir]);	$TglBekerja=sprintf("%02d%02d%02d",$_POST[ThnBekerja],$_POST[BlnBekerja],$_POST[TglBekerja]);	if (!empty($_POST[kode_jurusan])){		$jur = $_POST[kode_jurusan];		$tag=implode(',',$jur);	}  // Apabila password tidak diganti  if (empty($_POST[password])) {    $update=_query("UPDATE dosen SET 		username			= '$_POST[username]',		NIDN				= '$_POST[NIDN]',		nama_lengkap		= '$_POST[nama_lengkap]',		TempatLahir			= '$_POST[TempatLahir]',		TanggalLahir		= '$TanggalLahir',		KTP 				= '$_POST[KTP]',		Agama 				= '$_POST[Agama]',		Alamat 				= '$_POST[Alamat]',		Email 				= '$_POST[Email]',		Telepon 			= '$_POST[Telepon]',		Handphone 			= '$_POST[Handphone]',		Keterangan 			= '$_POST[Keterangan]',		Kota 				= '$_POST[Kota]',		Propinsi 			= '$_POST[Propinsi]',		Negara 				= '$_POST[Negara]',		Identitas_ID 		= '$_POST[identitas]',		Homebase 			= '$_POST[Homebase]',		Jurusan_ID 			= '$tag',      		Jabatan_ID 			= '$_POST[Jbtn]',      		Gelar 				= '$_POST[Gelar]',		Jenjang_ID 			= '$_POST[Jenjang_ID]',		Keilmuan 			= '$_POST[Keilmuan]',		JabatanDikti_ID 	= '$_POST[JabatanDikti_ID]',		InstitusiInduk 		= '$_POST[InstitusiInduk]',		TglBekerja			= '$TglBekerja',		StatusDosen_ID 		= '$_POST[StatusDosen_ID]',		StatusKerja_ID 		= '$_POST[StatusKerja_ID]',		Skpengankatan 		= '$_POST[Skpengankatan]',		Aktif 				= '$_POST[Aktif]'		WHERE dosen_ID		= '$_POST[id]'");		  		$upUseryapan=_query("UPDATE useryapan SET 			Nama			= '$_POST[nama_lengkap]',			email			= '$_POST[email]',			Jabatan			= '$_POST[Jbtn]',			aktif       	= '$_POST[Aktif]'			WHERE username	= '$_POST[username]'");	if($upUseryapan AND $update){		alert('info','Data Dosen Berhasil Update');		CatatLog($_SESSION['Nama'],'Update Data Dosen','Data Dosen Berhasil Update');		htmlRedirect('go-dosen.html',2);	}  }else{	$password=md5($_POST[password]);    $update=_query("UPDATE dosen SET username = '$_POST[username]',		password		='$password',		NIDN 			= '$_POST[NIDN]',		nama_lengkap 	= '$_POST[nama_lengkap]',		TempatLahir 	= '$_POST[TempatLahir]',		TanggalLahir 	= '$TanggalLahir',		KTP 			= '$_POST[KTP]',		Agama 			= '$_POST[Agama]',		Alamat 			= '$_POST[Alamat]',		Email 			= '$_POST[Email]',		Telepon 		= '$_POST[Telepon]',		Handphone 		= '$_POST[Handphone]',		Keterangan 		= '$_POST[Keterangan]',		Kota 			= '$_POST[Kota]',		Propinsi 		= '$_POST[Propinsi]',		Negara 			= '$_POST[Negara]',		Identitas_ID 	= '$_POST[identitas]',		Homebase 		= '$_POST[Homebase]',		Jurusan_ID 		= '$tag',		Jabatan_ID 		= '$_POST[Jbtn]',  		Gelar 			= '$_POST[Gelar]',		Jenjang_ID 		= '$_POST[Jenjang_ID]',		Keilmuan 		= '$_POST[Keilmuan]',		JabatanDikti_ID = '$_POST[JabatanDikti_ID]',		InstitusiInduk 	= '$_POST[InstitusiInduk]',		TglBekerja		= '$_POST[InstitusiInduk]',		StatusDosen_ID 	= '$_POST[StatusDosen_ID]',		StatusKerja_ID 	= '$_POST[StatusKerja_ID]',		Skpengankatan 	= '$_POST[Skpengankatan]',		Aktif 			= '$_POST[Aktif]'		WHERE dosen_ID	= '$_POST[id]'");		  		$upUseryapan=_query("UPDATE useryapan SET 				Nama 			= '$_POST[nama_lengkap]',				password    	= '$password',				email       	= '$_POST[email]',				Jabatan       	= '$_POST[Jbtn]',				aktif       	= '$_POST[Aktif]'				WHERE username	= '$_POST[username]'");	if($upUseryapan AND $update){					alert('info','Data Dosen Berhasil Update');		CatatLog($_SESSION['Nama'],'Update Data Dosen','Data Dosen Berhasil Update');		htmlRedirect('go-dosen.html',2);	}}}// Upload Foto Dosenif(isset($_POST['Upload'])) { 		if(empty($_POST['Id'])){		alert('error','User Belum Ada...!! Buat User Terlebih Dahulu');		CatatLog($_SESSION[Nama],'Upload Foto','Gagal Meng-Upload Foto Karena User Belum Ada.');	}else{		$id 			= $_POST['Id'];		$lokasi_file    = $_FILES['foto']['tmp_name'];		$tipe_file      = $_FILES['foto']['type'];		$nama_file      = $_FILES['foto']['name'];		$acak           = rand(1,99);		$nama_file_unik = $acak.$nama_file;		$dest = "media/images/foto_dosen/";		if (!empty($lokasi_file)){			if ($tipe_file != "image/jpeg" AND $tipe_file != "image/pjpeg"){			alert('info','Upload Gagal, Pastikan File yang di Upload bertipe *.JPG');		}else{			$Upload=UploadPhoto($nama_file_unik,$lokasi_file, $dest);			  if ($Upload){				$fotoc= _query("SELECT * FROM dosen where dosen_ID='$id' LIMIT 0,1") or die ();				$rfoto=_fetch_array($fotoc);				if($rfoto[foto]!=''){					unlink("$dest/$rfoto[foto]");      					unlink("$dest/small_$rfoto[foto]");      					unlink("$dest/medium_$rfoto[foto]");      				}				$UpdateFoto = _query("UPDATE dosen set foto='$nama_file_unik' where dosen_ID='$id'");				alert('info','Upload Foto Berhasil');				CatatLog($_SESSION[Nama],'Upload Foto','Upload Foto Berhasil');			  } else { 				alert("error", "Gagal Upload Foto.. !! Tidak dapat meng-upload file foto.<br />				Periksa file yg di-upload,  karena besar file dibatasi cuma: <b>$_POST[MAX_FILE_SIZE]</b> byte.");				CatatLog($_SESSION[Nama],'Upload Foto','Gagal Meng-Upload Foto Karena File Terlalu besar');				}			}		}	}}// Penelitianif(isset($_POST['UpdatePenelitian'])){	$md	= $_POST['md']+0;	$Tgldibuat=sprintf("%02d%02d%02d",$_POST['thn_Buat'],$_POST['bln_Buat'],$_POST['tgl_Buat']);	$nama_tabel="dosenpenelitian";if ($md == 0) {	$values="NamaPenelitian ='$_POST[NamaPenelitian]', 			DosenID			='$_POST[DosenID]', 			TglBuat 		='$Tgldibuat'";	$kondisi="DosenPenelitianID ='$_POST[DosenPenelitianID]'";	$update=update($nama_tabel,$values,$kondisi);	alert('info','Penelitian Dosen Berhasil Di Update');	CatatLog($_SESSION[Nama],'Update Penelitian Dosen','Penelitian Dosen Berhasil Di Update');	htmlRedirect("actions-dosen-edit-$md-$_POST[DosenID].html",1);}else{	$values="'','$_POST[NamaPenelitian]','$_POST[DosenID]','$Tgldibuat'";	$insert=insert($nama_tabel,$values);	alert('info','Penelitian Dosen Berhasil Di Simpan');	CatatLog($_SESSION[Nama],'Tambah Penelitian Dosen','Penelitian Dosen Berhasil Di Simpan');	htmlRedirect("actions-dosen-edit-$md-$_POST[DosenID].html",1);}}// Pekerjaanif(isset($_POST['UpdatePekerjaan'])){	$md	= $_POST['md']+0;	$nama_tabel="dosenpekerjaan";if ($md == 0) {	$values="DosenID='$_POST[DosenID]', 			Jabatan='$_POST[Jabatan]', 			Institusi='$_POST[Institusi]',			Alamat='$_POST[Alamat]',			Kota='$_POST[Kota]',			Kodepos='$_POST[Kodepos]',			Telepon='$_POST[Telepon]',			Fax='$_POST[Fax]'";	$kondisi="DosenPekerjaanID='$_POST[DosenPekerjaanID]'";	update($nama_tabel,$values,$kondisi);	alert('info','Pekerjaan Dosen Berhasil Di Update');	CatatLog($_SESSION[Nama],'Update Pekerjaan Dosen','Pekerjaan Dosen Berhasil Di Update');	htmlRedirect("actions-dosen-edit-$md-$_POST[DosenID].html",1);}else{	$values="'','$_POST[DosenID]','$_POST[Jabatan]','$_POST[Institusi]','$_POST[Alamat]','$_POST[Kota]','$_POST[Kodepos]','$_POST[Telepon]','$_POST[Fax]'";	insert($nama_tabel,$values);	alert('info','Pekerjaan Dosen Berhasil Di Simpan');	CatatLog($_SESSION[Nama],'Tambah Pekerjaan Dosen','Pekerjaan Dosen Berhasil Di Simpan');	htmlRedirect("actions-dosen-edit-$md-$_POST[DosenID].html",1);}}// Pendidikanif(isset($_POST['UpdatePendidikan'])){	$md	= $_POST['md']+0;	$Tglijazah=sprintf("%02d%02d%02d",$_POST[thn_Ijazah],$_POST[bln_Ijazah],$_POST[tgl_Ijazah]);	$nama_tabel="dosenpendidikan";if ($md == 0) {	$values="DosenID='$_POST[DosenID]', 			JenjangID='$_POST[JenjangID]', 			TanggalIjazah='$Tglijazah',			Gelar='$_POST[Gelar]',			PerguruanTinggiID='$_POST[PerguruanTinggiID]',			NamaNegara='$_POST[NamaNegara]',			BidangIlmu='$_POST[BidangIlmu]',			Prodi='$_POST[Prodi]'";	$kondisi="DosenPendidikanID='$_POST[DosenPendidikanID]'";	update($nama_tabel,$values,$kondisi);	alert('info','Pendidikan Dosen Berhasil Di Update');	CatatLog($_SESSION[Nama],'Update Pendidikan Dosen','Pendidikan Dosen Berhasil Di Update');	htmlRedirect("actions-dosen-edit-$md-$_POST[DosenID].html",1);}else{	$values="'','$_POST[DosenID]',			'$_POST[JenjangID]',			'$Tglijazah',			'$_POST[Gelar]',			'$_POST[PerguruanTinggiID]',			'$_POST[NamaNegara]',			'$_POST[BidangIlmu]',			'$_POST[Prodi]'";	insert($nama_tabel,$values);	alert('info','Pendidikan Dosen Berhasil Di Simpan');	CatatLog($_SESSION[Nama],'Tambah Pendidikan Dosen','Pendidikan Dosen Berhasil Di Simpan');	htmlRedirect("actions-dosen-edit-$md-$_POST[DosenID].html",1);}}// Import Data Dosenif(isset($_POST['ImportDosen'])){$identitas=$_SESSION['Identitas'];include "librari/excel_reader.php";	$data = new Spreadsheet_Excel_Reader($_FILES['import_file']['tmp_name']);	$baris = $data->rowcount($sheet_index=0);	$sukses = 0;	$gagal = 0;		for ($i=2; $i<=$baris; $i++)			{ 				$n1 = trimed($data->val($i, 1));				$n2 = trimed($data->val($i, 2));				$n3 = trimed($data->val($i, 3));				$n4 = trimed($data->val($i, 4));				$n5 = trimed($data->val($i, 5));				$n6 = trimed($data->val($i, 6));				$n7 = trimed($data->val($i, 7));				$n8 = trimed($data->val($i, 8));				$n9 = trimed($data->val($i, 9));				  // cek data, lalu sisipkan ke dalam tabel				$cekdata =_num_rows(_query("SELECT * FROM dosen WHERE NIDN ='$n1'"));				if($cekdata >0) {				alert("error","Oopss...Data NIDN <b>$n1</b> Sudah Ada Dalam Database");				CatatLog($_SESSION[Nama],'Import Data Dosen','Import Gagal Data Ada Yang Sama');				$sukses=false;				} else {				$hasil =_query( "INSERT INTO dosen (username,NIDN,nama_lengkap,TempatLahir,TanggalLahir,Identitas_ID,Jurusan_ID,Gelar,Aktif,Skpengankatan,Jabatan_ID) VALUES 				('$n1', '$n1', '$n2','$n4','$n5','$identitas','$n7','$n3','$n8','$n6','$n9')")or die("Gagal: <pre>$s</pre><br>".mysql_error());				if ($hasil){						$UserYapan ="INSERT INTO useryapan(username,LevelID,Nama,IdentitasID,kodeProdi,Bagian,Jabatan,aktif)VALUES										('$n1','2','$n2','$identitas','$n7','dosen','$n9','$n8')";						$InsertUserYapan=_query($UserYapan);				}			if ($hasil) $sukses++; else $gagal++;			$sukses=true;			}	}if($sukses){	alert("info","Import Data Dosen Selesai Sukses : $sukses | Gagal : $gagal ");	CatatLog($_SESSION[Nama],"Import Data Dosen","Import Data Dosen Selesai | Sukses : $sukses | Gagal : $gagal ");	}}// Hapus Dosenif(isset($_POST['delete'])){	$source = @$_POST['check'];	$source = multipleSelect($source);if(empty($source)){alert('error','Pilih Dosen yang Akan di Hapus');CatatLog($_SESSION[Nama],'Hapus Data Dosen','Gagal Meng-Hapus Dosen Belum Dipilih');}else{$del = explode(",",$source);foreach($del as $id){  $cek=_fetch_array(_query("SELECT * FROM dosen WHERE dosen_ID='$id'"));	$tabel1="dosenpekerjaan";	$kondisi1="DosenID='$id'";	delete($tabel1,$kondisi1);		$tabel2="dosenpendidikan";	$kondisi2="DosenID='$id'";	delete($tabel2,$kondisi2);		$tabel3="dosenpenelitian";	$kondisi3="DosenID='$id'";	delete($tabel3,$kondisi3);	if ($cek['foto']!=''){		$tabel="dosen";		$kondisi="dosen_ID='$id'";		delete($tabel,$kondisi);		unlink("$cek[foto]");				$tabell="useryapan";		$kondisii="username='$cek[username]'";		delete($tabell,$kondisii);	}else{		$tabel="dosen";		$kondisi="dosen_ID='$id'";		delete($tabel,$kondisi);				$tabell="useryapan";		$kondisii="username='$id'";		delete($tabell,$kondisii);	} }alert('info','Data Dosen Berhasil di Hapus');CatatLog($_SESSION[Nama],'Hapus Data Dosen','Data Dosen Berhasil di Hapus');htmlRedirect('go-dosen.html',2);}}