<?phpdefined('_FINDEX_') or die('Access Denied');$db = new FQuery();  $db -> connect();//Buat BackUpif(isset($_POST['Backup'])) { 		$nama_file	  =date("d_M_Y_H_i_s").'.sql';	$database = FDBName;	$dir = 'media/files/backups/';	$tables='';	if($tables == '')	{		$tables = array();		$result = @mysql_list_tables($database);		while($row = @mysql_fetch_row($result))		{			$tables[] = $row[0];		}	}else{		$tables = is_array($tables) ? $tables : explode(',',$tables);	}		$return	= '';		foreach($tables as $table)	{		$result	 = @mysql_query('SELECT * FROM '.$table);		$num_fields = @mysql_num_fields($result);				//menyisipkan query drop table untuk nanti hapus table yang lama		$return	.= "DROP TABLE IF EXISTS ".$table.";";		$row2	 = @mysql_fetch_row(mysql_query('SHOW CREATE TABLE  '.$table));		$return	.= "\n\n".$row2[1].";\n\n";				for ($i = 0; $i < $num_fields; $i++) 		{			while($row = @mysql_fetch_row($result))			{				$return.= 'INSERT INTO '.$table.' VALUES(';				for($j=0; $j<$num_fields; $j++) 				{					$row[$j] = @addslashes($row[$j]);					$row[$j] = @ereg_replace("\n","\\n",$row[$j]);					if (isset($row[$j])) { $return.= '"'.$row[$j].'"' ; } else { $return.= '""'; }					if ($j<($num_fields-1)) { $return.= ','; }				}				$return.= ");\n";			}		}		$return.="\n\n\n";	}		$nama_file;		$handle = fopen($dir.$nama_file,'w+');	$backup= fwrite($handle, $return);	fclose($handle);	if($backup AND isset($_POST['Backup'])){							alert('info','Backup database telah selesai');		CatatLog($_SESSION[Nama],'Backup database','Backup Sukses');	}}// Hapus BackUpif(isset($_POST['delete'])){	$source = @$_POST['check'];	$source = multipleSelect($source);	if(empty($source)){	alert('error','Pilih Data Back Up yang Akan di Hapus terlebih dahulu');	CatatLog($_SESSION[Nama],'Delete BackUp','Gagal Meng-Hapus BackUp. Pilih Data Terlebih dahulu');	}else{	$del = explode(",",$source);		foreach($del as $id)		{			$dir = 'media/files/backups/';			$file = $dir.$id;			$delete=unlink($file);		}	alert('info','Data Back Up Berhasil di Hapus');	CatatLog($_SESSION[Nama],'Delete BackUp','Data Back Up Berhasil di Hapus');	}}//Restore BackUpif(isset($_POST['Restore'])) { 	global $rest_dir;	$files		= $_FILES['backup_file'];	$nama_file	= $files['name'];	$ukrn_file	= $files['size'];	$tmp_file	= $files['tmp_name'];		if ($nama_file == "")	{	alert('error','Pilih File Backup dahulu');	CatatLog($_SESSION[Nama],'Restore database','Gagal...Pilih File Backup dahulu');	}	else	{		$alamatfile	= $rest_dir.$nama_file;		$templine	= array();				if (move_uploaded_file($tmp_file , $alamatfile))		{						$templine	= '';			$lines		= file($alamatfile);			foreach ($lines as $line)			{				if (substr($line, 0, 2) == '--' || $line == '')					continue;			 				$templine .= $line;				if (substr(trim($line), -1, 1) == ';')				{					mysql_query($templine) or print('Query gagal \'<strong>' . $templine . '\': ' . mysql_error() . '<br /><br />');					$templine = '';				}			}	alert('info','Data Back Up Berhasil di Hapus');	CatatLog($_SESSION[Nama],'Restore database','Database Berhasil Di Restore');		}else{	alert("error","Proses Restore GAGAL..!! kode error = " . $file['error']);	CatatLog($_SESSION[Nama],'Restore database','Database GAGAL Di Restore');		}		}}